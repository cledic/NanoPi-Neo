
# Compilazione di math-neon

Di seguito le istruzioni per scaricare e compilare su NanoPi Neo il programma math-debug


```C
git clone https://github.com/andrepuschmann/math-neon.git
cd math-neon
mkdir build
cd build
cmake ..
```

A questo punto dobbiamo modificare un file per generare correttamente le flag del compilatore per la nostra MCU

```C
vi ../src/CMakeLists.txt
```

Modificare questa riga come di seguito:

```C
set(CMAKE_CXX_FLAGS "-O3 -std=gnu99 -march=armv7-a -mtune=cortex-a7 -mfpu=neon-vfpv4 -mfloat-abi=hard")
```

Alla fine della compilazione eseguire il programma:
```C
./src/math_debug
```

# Risultati

```
root@nanopineo:~/math-neon/build# ./src/math_debug
RUNFAST: Enabled
------------------------------------------------------------------------------------------------------
MATRIX FUNCTION TESTS
------------------------------------------------------------------------------------------------------
matmul2_c =
                        |2.57, 9.78|
                        |-17.98, -23.11|
matmul2_neon =
                        |2.57, 9.78|
                        |-17.98, -23.11|
matmul2: c=190000        neon=70000      rate=2.71
matvec2_c = |2.57, -17.98|
matvec2_neon = |2.57, -17.98|
matvec2: c=110000        neon=60000      rate=1.83
matmul3_c =
                        |-17.43, 17.33, 20.60|
                        |-3.89, 1.35, 6.48|
                        |-15.03, 15.32, 17.97|
matmul3_neon =
                        |-17.43, 17.33, 20.60|
                        |-3.89, 1.35, 6.48|
                        |-15.03, 15.32, 17.97|
matmul3: c=570000        neon=170000     rate=3.35
matvec3_c = |-17.43, -3.89, -15.03|
matvec3_neon = |-17.43, -3.89, -15.03|
matvec3: c=110000        neon=60000      rate=1.83
matmul4_c =
                        |3.00, -7.41, -6.70, 1.99|
                        |-33.08, 25.05, 9.02, 22.59|
                        |7.69, -11.58, -2.82, -10.36|
                        |-12.05, 18.16, 21.77, 20.63|
matmul4_neon =
                        |3.00, -7.41, -6.70, 1.99|
                        |-33.08, 25.05, 9.02, 22.59|
                        |7.69, -11.58, -2.82, -10.36|
                        |-12.05, 18.16, 21.77, 20.63|
matmul4: c=1320000       neon=190000     rate=6.95
matvec4_c = |3.00, -33.08, 7.69, -12.045038|
matvec4_neon = |3.00, -33.08, 7.69, -12.045038|
matvec4: c=110000        neon=60000      rate=1.83

dot2_c = -11.951492
dot2_neon = -11.951492
dot2: c=380000   neon=380000     rate=1.00
normalize2_c = [0.32, -0.95]
normalize2_neon = [0.32, -0.95]
normalize2: c=840000     neon=490000     rate=1.71

dot3_c = -5.970533
dot3_neon = -5.970533
dot3: c=490000   neon=410000     rate=1.20
normalize3_c = [0.23, -0.69, -0.69]
normalize3_neon = [0.23, -0.69, -0.69]
normalize3: c=1030000    neon=530000     rate=1.94
cross3_c = [13.22, 15.93, -11.43]
cross3_neon = [13.22, 15.93, -11.43]
cross3: c=750000         neon=370000     rate=2.03

dot4_c = -8.523204
dot4_neon = -8.523204
dot4: c=600000   neon=420000     rate=1.43
normalize4_c = [0.23, -0.67, -0.67, -0.24]
normalize4_neon = [0.23, -0.67, -0.67, -0.24]
normalize4: c=1220000    neon=550000     rate=2.22

------------------------------------------------------------------------------------------------------
CMATH FUNCTION TESTS
------------------------------------------------------------------------------------------------------
Function        Range           Number  ABS Max Error   REL Max Error   RMS Error       Time    Rate
------------------------------------------------------------------------------------------------------
sinf            [-3.14, 3.14]   500000  0.00e+00        0.00e+00%       0.00e+00        80000   x1.00
sinf_c          [-3.14, 3.14]   500000  8.34e-07        1.00e+02%       4.09e-07        100000  x0.80
sinf_neon       [-3.14, 3.14]   500000  1.00e+00        1.00e+02%       7.07e-01        80000   x1.00
cosf            [-3.14, 3.14]   500000  0.00e+00        0.00e+00%       0.00e+00        80000   x1.00
cosf_c          [-3.14, 3.14]   500000  8.34e-07        6.74e-01%       4.16e-07        130000  x0.62
cosf_neon       [-3.14, 3.14]   500000  1.00e+00        1.00e+02%       7.06e-01        100000  x0.80
tanf            [-0.79, 0.79]   500000  0.00e+00        0.00e+00%       0.00e+00        80000   x1.00
tanf_c          [-0.79, 0.79]   500000  2.98e-06        7.97e-04%       1.31e-06        150000  x0.53
tanf_neon       [-0.79, 0.79]   500000  2.15e-01        2.15e+01%       7.57e-02        110000  x0.73
asinf           [-1.00, 1.00]   500000  0.00e+00        0.00e+00%       0.00e+00        140000  x1.00
asinf_c         [-1.00, 1.00]   500000  5.54e-05        1.06e-02%       1.69e-05        190000  x0.74
asinf_neon      [-1.00, 1.00]   500000  4.66e-05        8.90e-03%       nan     130000  x1.08
acosf           [-1.00, 1.00]   500000  0.00e+00        0.00e+00%       0.00e+00        150000  x1.00
acosf_c         [-1.00, 1.00]   500000  5.56e-05        6.46e-03%       1.69e-05        200000  x0.75
acosf_neon      [-1.00, 1.00]   500000  4.71e+00        1.02e+05%       nan     140000  x1.07
atanf           [-1.00, 1.00]   500000  0.00e+00        0.00e+00%       0.00e+00        70000   x1.00
atanf_c         [-1.00, 1.00]   500000  1.67e-04        2.12e-02%       7.40e-05        130000  x0.54
atanf_neon      [-1.00, 1.00]   500000  7.85e-01        1.00e+02%       4.96e-01        100000  x0.70
sinhf           [-3.14, 3.14]   500000  0.00e+00        0.00e+00%       0.00e+00        140000  x1.00
sinhf_c         [-3.14, 3.14]   500000  1.91e-06        1.52e-01%       2.37e-07        200000  x0.70
sinhf_neon      [-3.14, 3.14]   500000  8.41e+00        7.28e+01%       2.87e+00        90000   x1.56
coshf           [-3.14, 3.14]   500000  0.00e+00        0.00e+00%       0.00e+00        150000  x1.00
coshf_c         [-3.14, 3.14]   500000  1.91e-06        2.37e-05%       2.22e-07        190000  x0.79
coshf_neon      [-3.14, 3.14]   500000  1.47e+01        1.66e+02%       5.00e+00        100000  x1.50
tanhf           [-3.14, 3.14]   500000  0.00e+00        0.00e+00%       0.00e+00        130000  x1.00
tanhf_c         [-3.14, 3.14]   500000  1.21e-05        2.48e-01%       5.48e-06        160000  x0.81
tanhf_neon      [-3.14, 3.14]   500000  2.15e+00        2.15e+02%       1.04e+00        100000  x1.30
expf            [0.00, 10.00]   500000  0.00e+00        0.00e+00%       0.00e+00        130000  x1.00
expf_c          [0.00, 10.00]   500000  9.77e-03        6.55e-05%       1.64e-03        90000   x1.44
expf_neon       [0.00, 10.00]   500000  2.20e+04        1.00e+02%       4.92e+03        80000   x1.62
logf            [1.00, 1000.00] 500000  0.00e+00        0.00e+00%       0.00e+00        90000   x1.00
logf_c          [1.00, 1000.00] 500000  7.63e-06        1.03e-02%       1.07e-06        90000   x1.00
logf_neon       [1.00, 1000.00] 500000  6.21e+00        inf%    5.30e+00        70000   x1.29
log10f          [1.00, 1000.00] 500000  0.00e+00        0.00e+00%       0.00e+00        110000  x1.00
log10f_c        [1.00, 1000.00] 500000  3.34e-06        6.68e-03%       4.84e-07        90000   x1.22
log10f_neon     [1.00, 1000.00] 500000  2.70e+00        inf%    2.30e+00        70000   x1.57
floorf          [1.00, 1000.00] 5000000 0.00e+00        0.00e+00%       0.00e+00        290000  x1.00
floorf_c        [1.00, 1000.00] 5000000 0.00e+00        0.00e+00%       0.00e+00        410000  x0.71
floorf_neon     [1.00, 1000.00] 5000000 1.00e+00        1.00e+02%       5.85e-01        460000  x0.63
ceilf           [1.00, 1000.00] 5000000 0.00e+00        0.00e+00%       0.00e+00        290000  x1.00
ceilf_c         [1.00, 1000.00] 5000000 0.00e+00        0.00e+00%       0.00e+00        390000  x0.74
ceilf_neon      [1.00, 1000.00] 5000000 1.00e+00        5.00e+01%       5.85e-01        470000  x0.62
fabsf           [1.00, 1000.00] 5000000 0.00e+00        0.00e+00%       0.00e+00        180000  x1.00
fabsf_c         [1.00, 1000.00] 5000000 0.00e+00        0.00e+00%       0.00e+00        290000  x0.62
fabsf_neon      [1.00, 1000.00] 5000000 0.00e+00        0.00e+00%       0.00e+00        230000  x0.78
sqrtf           [1.00, 1000.00] 500000  0.00e+00        0.00e+00%       0.00e+00        140000  x1.00
sqrtf_c         [1.00, 1000.00] 500000  2.33e-04        1.06e-03%       8.69e-05        90000   x1.56
sqrtf_neon      [1.00, 1000.00] 500000  9.68e+02        3.06e+03%       5.54e+02        60000   x2.33
invsqrtf        [1.00, 1000.00] 500000  0.00e+00        0.00e+00%       0.00e+00        170000  x1.00
invsqrtf_c      [1.00, 1000.00] 500000  4.35e-06        4.78e-04%       2.00e-07        60000   x2.83
invsqrtf_neon   [1.00, 1000.00] 500000  1.00e+03        3.16e+06%       5.76e+02        50000   x3.40
atan2f          [0.10, 10.00]   10000   0.00e+00        0.00e+00%       0.00e+00        250000  x1.00
atan2f_c        [0.10, 10.00]   10000   1.73e-04        2.23e-02%       0.00e+00        410000  x0.61
atan2f_neon     [0.10, 10.00]   10000   6.75e+09        8.59e+11%       0.00e+00        250000  x1.00
powf            [1.00, 10.00]   10000   0.00e+00        0.00e+00%       0.00e+00        710000  x1.00
powf_c          [1.00, 10.00]   10000   1.36e+05        5.88e-03%       0.00e+00        390000  x1.82
powf_neon       [1.00, 10.00]   10000   9.97e+09        1.00e+02%       0.00e+00        290000  x2.45
fmodf           [1.00, 10.00]   10000   0.00e+00        0.00e+00%       0.00e+00        110000  x1.00
fmodf_c         [1.00, 10.00]   10000   9.99e+00        8.06e-02%       0.00e+00        240000  x0.46
fmodf_neon      [1.00, 10.00]   10000   1.00e+01        1.69e+06%       0.00e+00        190000  x0.58
```
